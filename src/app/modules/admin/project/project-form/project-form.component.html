<nb-card>
    <nb-card-header>
        <span>Chỉnh sửa dự án ({{ typeLabel }})</span>
    </nb-card-header>
    <nb-card-body>
        <!-- Loading -->
        <div *ngIf="!selectedCategory" class="text-center p-4">
            <span>Đang tải thông tin dự án...</span>
        </div>

        <!-- Form dự án -->
        <div *ngIf="selectedCategory">
            <!-- Danh mục (chỉ hiển thị, không cho sửa) -->
            <div class="form-group">
                <label class="label">Danh mục</label>
                <input nbInput fullWidth [value]="selectedCategory.name" disabled>
            </div>

            <!-- Tên dự án -->
            <div class="form-group">
                <label class="label">Tên dự án <span class="text-danger">*</span></label>
                <input nbInput fullWidth placeholder="Nhập tên dự án..." [(ngModel)]="project.name">
            </div>

            <hr>
            <h6>Thông tin chi tiết ({{ selectedCategory.name }})</h6>

            <!-- Dynamic Fields từ category.schema -->
            <div class="form-group" *ngFor="let field of selectedCategory.schema">
                <label class="label">
                    {{ field.label }}
                    <span class="text-danger" *ngIf="field.required">*</span>
                </label>
                <small *ngIf="field.description" class="d-block text-muted mb-1">{{ field.description }}</small>

                <!-- Text Input -->
                <input *ngIf="field.type === 'text'" nbInput fullWidth
                    [placeholder]="field.placeholder || 'Nhập ' + field.label.toLowerCase() + '...'"
                    [(ngModel)]="project.data[field.label]">

                <!-- Number Input -->
                <input *ngIf="field.type === 'number'" nbInput fullWidth type="number"
                    [placeholder]="field.placeholder || 'Nhập ' + field.label.toLowerCase() + '...'"
                    [(ngModel)]="project.data[field.label]">

                <!-- Date Input -->
                <input *ngIf="field.type === 'date'" nbInput fullWidth [nbDatepicker]="datepicker"
                    [placeholder]="field.placeholder || 'Chọn ' + field.label.toLowerCase() + '...'"
                    [(ngModel)]="project.data[field.label]">
                <nb-datepicker #datepicker *ngIf="field.type === 'date'"></nb-datepicker>

                <!-- Select Input -->
                <nb-select *ngIf="field.type === 'select'" fullWidth
                    [placeholder]="field.placeholder || 'Chọn ' + field.label.toLowerCase() + '...'"
                    [(ngModel)]="project.data[field.label]">
                    <nb-option *ngFor="let opt of field.options" [value]="opt.value || opt">
                        {{ opt.label || opt }}
                    </nb-option>
                </nb-select>

                <!-- HTML/Textarea Input -->
                <textarea *ngIf="field.type === 'html'" nbInput fullWidth rows="4"
                    [placeholder]="field.placeholder || 'Nhập nội dung...'"
                    [(ngModel)]="project.data[field.label]"></textarea>

                <!-- Images Upload (placeholder) -->
                <div *ngIf="field.type === 'images'" class="media-upload-zone">
                    <div class="upload-box">
                        <nb-icon icon="image-outline" class="upload-icon"></nb-icon>
                        <span>Kéo thả ảnh hoặc click để upload</span>
                        <small class="text-muted d-block">Hỗ trợ: JPG, PNG, GIF</small>
                    </div>
                    <div class="url-input mt-2">
                        <input nbInput fullWidth size="small" placeholder="Hoặc nhập URL ảnh...">
                        <button nbButton size="small" status="primary" class="mt-1">Thêm URL</button>
                    </div>
                </div>

                <!-- Video Upload (placeholder) -->
                <div *ngIf="field.type === 'video'" class="media-upload-zone">
                    <div class="upload-box video">
                        <nb-icon icon="video-outline" class="upload-icon"></nb-icon>
                        <span>Kéo thả video hoặc click để upload</span>
                        <small class="text-muted d-block">Hỗ trợ: MP4, WebM, YouTube URL</small>
                    </div>
                    <div class="url-input mt-2">
                        <input nbInput fullWidth size="small" placeholder="Hoặc nhập URL video...">
                        <button nbButton size="small" status="primary" class="mt-1">Thêm URL</button>
                    </div>
                </div>
            </div>
        </div>
    </nb-card-body>
    <nb-card-footer>
        <button nbButton status="primary" (click)="onSubmit()" [disabled]="!selectedCategory">
            <nb-icon icon="save-outline"></nb-icon> Lưu
        </button>
        <button nbButton status="basic" (click)="cancel()">
            <nb-icon icon="close-outline"></nb-icon> Hủy
        </button>
    </nb-card-footer>
</nb-card>